<!--First is to iterate though the set of questions to get individual ones -->
<h2> List of questions posted </h2>
<% i = 1 %>
<% questions = Question.all %>
<% questions.each do |question| %>
	<%= "#{i})" %> <a href="/questions/<%= question.id %>"><%= question.title %></a> by <%= question.user.name%>

<!--If there are no votes in the question -->
	<% if question.votes.count == 0 %>
		<% @can_vote = true %>

<!--If there are votes in the question, we isolate each vote -->		
	<% else question.votes.each do |vote| %>
	<!--If we get a vote that matches the logged in user-->
		<% if vote.user_id == session[:user_id] %>
			<% @can_vote = false %>	
			<form action="/upvote/<%= question.id %>/<%= vote.id %>/reset" method="POST">
				<input type="submit" value="upvote"></form>
			<form action="/downvote/<%= question.id %>/<%= vote.id %>/reset" method="POST">
				<input type="submit" value="downvote"></form>
			<form action="/questions/<%= question.id %>/<%= vote.id %>/reset" method="POST">
				<input type="submit" value="reset"></form>
			<% break %>
		<% else vote.user_id != session[:user_id] %>
			<% @can_vote = true %>
		<% end %>
	<% end %>
<% end %><br>
<!--we use the can_vote variable in order to ensure we don't get a repeat if question.votes.count == 0 -->
<% if @can_vote == true %>
	<form action="/questions/<%= question.id %>/upvote" method="POST" class="up" data-id="<%= question.id %>">
		<input type="submit" value="upvote"></form>
	<a href="/questions/<%= question.id %>/downvote"><button class="down">downvote</button></a><br>
<% end %>

	<!--To show vote count(s) by type-->
	Total question vote(s): <span id="vote-result-<%= question.id %>"><%= question.votes.count %><br> </span>
	Total question upvote(s): <%= question.votes.where(vote_count: 1).count %><br>
	Total question downvote(s)	<%= question.votes.where(vote_count: -1).count %><br><br>
	<% i += 1 %>

	<!-- To list all possible answers for a question -->
	<strong>List of Answers</strong><br>
	<% if question.answers.count == 0 %>
		No answers yet, would you want answer it?
	<% else %>
		<% question_answers = question.answers %>
		<% question_answers.each.with_index do |answer, index| %>
			<%= index + 1 %><%= ". " %><%= answer.reply %><br>

	<!--The form for up voting on answers -->
	<form action="/answers/<%= answer.id %>/upvote" method="POST" class="answer_up" data-id="<%= answer.id %>">
		<input type="submit" value="a. upvote"></form>

	<!--To find the total amount of votes by type-->	
	Total answer vote(s): <span id="vote-result-<%= answer.id %>"><%= answer.answer_votes.count %><br> </span>
	Total answer upvote(s): <%= answer.answer_votes.where(vote_count: 1).count %><br>

		<% end %>
	<% end %>
<br><% end %>